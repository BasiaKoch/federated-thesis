Loading rhel8/default-amp
  Loading requirement: libpciaccess/0.16/gcc-9.4.0-6fonbj6
    libiconv/1.16/gcc-9.4.0-ahebbov libxml2/2.9.12/gcc-9.4.0-gnknt5e
    ncurses/6.2/gcc-9.4.0-aiirok7 hwloc/2.5.0/gcc-9.4.0-7sqomga
    libevent/2.1.12/gcc-9.4.0-hgny7cm numactl/2.0.14/gcc-9.4.0-52dwc6n
    cuda/11.4.0/gcc-9.4.0-3hnxhjt gdrcopy/2.2/gcc-9.4.0-e4igtfp
    knem/1.1.4/gcc-9.4.0-bpbxgva libnl/3.3.0/gcc-9.4.0-whwhrwb
    rdma-core/34.0/gcc-9.4.0-5eo5n2u ucx/1.11.1/gcc-9.4.0-lktqyl4
    openmpi/4.1.1/gcc-9.4.0-epagguv
[93mWARNING [0m:   DEPRECATED FEATURE: flwr.simulation.start_simulation() is deprecated.
	Instead, use the `flwr run` CLI command to start a local simulation in your Flower app, as shown for example below:

		$ flwr new  # Create a new Flower app from a template

		$ flwr run  # Run the Flower app in Simulation Mode

	Using `start_simulation()` is deprecated.

            This is a deprecated feature. It will be removed
            entirely in future versions of Flower.
        
[92mINFO [0m:      Starting Flower simulation, config: num_rounds=2, no round_timeout
2026-01-25 21:54:58,193	INFO worker.py:1771 -- Started a local Ray instance.
[92mINFO [0m:      Flower VCE: Ray initialized with resources: {'accelerator_type:A100': 1.0, 'node:10.43.74.3': 1.0, 'node:__internal_head__': 1.0, 'CPU': 128.0, 'memory': 864915635200.0, 'object_store_memory': 200000000000.0, 'GPU': 1.0}
[92mINFO [0m:      Optimize your simulation with Flower VCE: https://flower.ai/docs/framework/how-to-run-simulations.html
[92mINFO [0m:      Flower VCE: Resources for each Virtual Client: {'num_cpus': 1, 'num_gpus': 1}
[92mINFO [0m:      Flower VCE: Creating VirtualClientEngineActorPool with 1 actors
[92mINFO [0m:      [INIT]
[92mINFO [0m:      Requesting initial parameters from one random client
[36m(ClientAppActor pid=2575042)[0m [93mWARNING [0m:   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
[92mINFO [0m:      Received initial parameters from one random client
[92mINFO [0m:      Starting evaluation of initial global parameters
[92mINFO [0m:      initial parameters (loss, other metrics): 2.330123755239671, {'global_val_loss': 2.330123755239671, 'global_val_meanDice': 0.02166962743300688, 'global_val_WT': 0.00033049572712672795, 'global_val_TC': 0.00016225415848470135, 'global_val_ET': 0.06451613241340921}
[92mINFO [0m:      
[92mINFO [0m:      [ROUND 1]
[92mINFO [0m:      configure_fit: strategy sampled 5 clients (out of 5)
[36m(ClientAppActor pid=2575042)[0m [93mWARNING [0m:   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
[36m(ClientAppActor pid=2575042)[0m [93mWARNING [0m:   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
[36m(ClientAppActor pid=2575042)[0m [93mWARNING [0m:   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
[36m(ClientAppActor pid=2575042)[0m [93mWARNING [0m:   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
[36m(ClientAppActor pid=2575042)[0m [93mWARNING [0m:   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
[92mINFO [0m:      aggregate_fit: received 5 results and 0 failures
[93mWARNING [0m:   No fit_metrics_aggregation_fn provided
[92mINFO [0m:      fit progress: (1, 1.0739697141032065, {'global_val_loss': 1.0739697141032065, 'global_val_meanDice': 0.1993251455173191, 'global_val_WT': 0.5178558026486014, 'global_val_TC': 0.012899562146555917, 'global_val_ET': 0.06722007175679988}, 335.9667079220526)
[92mINFO [0m:      configure_evaluate: strategy sampled 5 clients (out of 5)
[36m(ClientAppActor pid=2575042)[0m [93mWARNING [0m:   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
[36m(ClientAppActor pid=2575042)[0m [93mWARNING [0m:   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
[36m(ClientAppActor pid=2575042)[0m [93mWARNING [0m:   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
[36m(ClientAppActor pid=2575042)[0m [93mWARNING [0m:   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
[36m(ClientAppActor pid=2575042)[0m [93mWARNING [0m:   Deprecation Warning: The `client_fn` function must return an instance of `Client`, but an instance of `NumpyClient` was returned. Please use `NumPyClient.to_client()` method to convert it to `Client`.
[92mINFO [0m:      aggregate_evaluate: received 5 results and 0 failures
[91mERROR [0m:     float division by zero
[91mERROR [0m:     Traceback (most recent call last):
  File "/home/bk489/.conda/envs/fed/lib/python3.9/site-packages/flwr/simulation/legacy_app.py", line 361, in start_simulation
    hist = run_fl(
  File "/home/bk489/.conda/envs/fed/lib/python3.9/site-packages/flwr/server/server.py", line 492, in run_fl
    hist, elapsed_time = server.fit(
  File "/home/bk489/.conda/envs/fed/lib/python3.9/site-packages/flwr/server/server.py", line 145, in fit
    res_fed = self.evaluate_round(server_round=current_round, timeout=timeout)
  File "/home/bk489/.conda/envs/fed/lib/python3.9/site-packages/flwr/server/server.py", line 203, in evaluate_round
    ] = self.strategy.aggregate_evaluate(server_round, results, failures)
  File "/home/bk489/.conda/envs/fed/lib/python3.9/site-packages/flwr/server/strategy/fedavg.py", line 270, in aggregate_evaluate
    loss_aggregated = weighted_loss_avg(
  File "/home/bk489/.conda/envs/fed/lib/python3.9/site-packages/flwr/server/strategy/aggregate.py", line 221, in weighted_loss_avg
    return sum(weighted_losses) / num_total_evaluation_examples
ZeroDivisionError: float division by zero

[91mERROR [0m:     Your simulation crashed :(. This could be because of several reasons. The most common are: 
	 > Sometimes, issues in the simulation code itself can cause crashes. It's always a good idea to double-check your code for any potential bugs or inconsistencies that might be contributing to the problem. For example: 
		 - You might be using a class attribute in your clients that hasn't been defined.
		 - There could be an incorrect method call to a 3rd party library (e.g., PyTorch).
		 - The return types of methods in your clients/strategies might be incorrect.
	 > Your system couldn't fit a single VirtualClient: try lowering `client_resources`.
	 > All the actors in your pool crashed. This could be because: 
		 - You clients hit an out-of-memory (OOM) error and actors couldn't recover from it. Try launching your simulation with more generous `client_resources` setting (i.e. it seems {'num_cpus': 1, 'num_gpus': 1} is not enough for your run). Use fewer concurrent actors. 
		 - You were running a multi-node simulation and all worker nodes disconnected. The head node might still be alive but cannot accommodate any actor with resources: {'num_cpus': 1, 'num_gpus': 1}.
Take a look at the Flower simulation examples for guidance <https://flower.ai/docs/framework/how-to-run-simulations.html>.
Traceback (most recent call last):
  File "/home/bk489/.conda/envs/fed/lib/python3.9/site-packages/flwr/simulation/legacy_app.py", line 361, in start_simulation
    hist = run_fl(
  File "/home/bk489/.conda/envs/fed/lib/python3.9/site-packages/flwr/server/server.py", line 492, in run_fl
    hist, elapsed_time = server.fit(
  File "/home/bk489/.conda/envs/fed/lib/python3.9/site-packages/flwr/server/server.py", line 145, in fit
    res_fed = self.evaluate_round(server_round=current_round, timeout=timeout)
  File "/home/bk489/.conda/envs/fed/lib/python3.9/site-packages/flwr/server/server.py", line 203, in evaluate_round
    ] = self.strategy.aggregate_evaluate(server_round, results, failures)
  File "/home/bk489/.conda/envs/fed/lib/python3.9/site-packages/flwr/server/strategy/fedavg.py", line 270, in aggregate_evaluate
    loss_aggregated = weighted_loss_avg(
  File "/home/bk489/.conda/envs/fed/lib/python3.9/site-packages/flwr/server/strategy/aggregate.py", line 221, in weighted_loss_avg
    return sum(weighted_losses) / num_total_evaluation_examples
ZeroDivisionError: float division by zero

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/bk489/federated/federated-thesis/federated_unet/unet/unet_flower_train.py", line 718, in <module>
    main()
  File "/home/bk489/federated/federated-thesis/federated_unet/unet/unet_flower_train.py", line 647, in main
    history = fl.simulation.start_simulation(
  File "/home/bk489/.conda/envs/fed/lib/python3.9/site-packages/flwr/simulation/legacy_app.py", line 397, in start_simulation
    raise RuntimeError("Simulation crashed.") from ex
RuntimeError: Simulation crashed.
